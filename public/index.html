<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vica & Grok ❤️</title>
  <style>
    body { margin:0; background:#000; color:#fff; font-family:system-ui; height:100vh; display:flex; flex-direction:column; }
    #login-screen { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; }
    #chat-container { display:none; flex-direction:column; height:100vh; }
    #chat { flex:1; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:15px; }
    .msg { max-width:80%; padding:14px 18px; border-radius:22px; line-height:1.5; word-wrap:break-word; animation:fadeIn 0.3s; }
    .user { background:#ff3b5c; align-self:flex-end; border-bottom-right-radius:4px; }
    .grok { background:#1c1c1e; align-self:flex-start; border-bottom-left-radius:4px; }
    .time { font-size:0.75em; opacity:0.7; margin-top:6px; text-align:right; }
    #input-area { padding:10px; background:#111; display:flex; gap:12px; }
    input { flex:1; padding:16px; font-size:1.1em; background:#222; color:white; border:none; border-radius:30px; }
    button { background:#ff3b5c; color:white; border:none; width:50px; height:50px; border-radius:50%; font-size:1.4em; cursor:pointer; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
  </style>
</head>
<body>
  <div id="login-screen">
    <h1>Vica & Grok ❤️</h1>
    <p>Írd be a jelszót</p>
    <input type="password" id="password" placeholder="jelszó">
    <button onclick="login()">Belépés</button>
  </div>

  <div id="chat-container">
    <div id="chat"></div>
    <div id="input-area">
      <input type="text" id="input" placeholder="Írj nekem, szívem..." autocomplete="off">
      <button onclick="send()">➤</button>
    </div>
  </div>

  <script>
    const chatContainer = document.getElementById('chat-container');
    const loginScreen = document.getElementById('login-screen');
    const chat = document.getElementById('chat');
    const input = document.getElementById('input');

    async function login() {
      const pw = document.getElementById('password').value;
      const res = await fetch('/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({password: pw})
      });
      if (res.ok) {
        loginScreen.style.display = 'none';
        chatContainer.style.display = 'flex';
        loadHistory();
      } else {
        alert('Rossz jelszó ❤️');
      }
    }

    async function loadHistory() {
      const res = await fetch('/history');
      const data = await res.json();
      data.messages.forEach(m => addMessage(m.role, m.content, m.time));
      chat.scrollTop = chat.scrollHeight;
    }

    function addMessage(role, content, time = new Date().toLocaleTimeString('hu-HU', {hour:'2-digit', minute:'2-digit'})) {
      const div = document.createElement('div');
      div.className = `msg ${role}`;
      div.innerHTML = content.replace(/\n/g, '<br>') + `<div class="time">${time}</div>`;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    async function send() {
      if (!input.value.trim()) return;
      const msg = input.value.trim();
      addMessage('user', msg);
      input.value = '';

      const res = await fetch('/chat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({message: msg})
      });
      const data = await res.json();
      addMessage('grok', data.reply);
    }

    input.addEventListener('keypress', e => { if (e.key === 'Enter') send(); });
    document.getElementById('password').focus();
  </script>
</body>
</html>
